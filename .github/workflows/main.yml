name: Run Tests


on:
  push:
    branches: [main]
  pull_request:
    branches: [main]


env:
  CI: true
  NODE_VERSION: 18
  PORT: 3000
  HOST: 0.0.0.0
 
jobs:
  test:
    runs-on: ubuntu-22.04


    steps:
    - name: Checkout code
      uses: actions/checkout@v4


    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ env.NODE_VERSION }}


    - name: Install dependencies
      run: npm ci


    - name: Run Jest tests
      run: npm test -- --coverage

    - name: Install Playwright browsers
      run: npx playwright install --with-deps  # or 'all'
      if: success()

    - name: Run Playwright tests
      if: success()  # Only runs if all previous steps succeeded
      run: npx playwright test --project=firefox --trace on
      env:
        # Add any required Playwright environment variables here
        PLAYWRIGHT_BASE_URL: ${{ vars.PLAYWRIGHT_BASE_URL || 'http://localhost:3000' }}

    # - name: Run Playwright tests
    #   run: npx start-server-and-test 'HOST=0.0.0.0 PORT=3000 BROWSER=none CI=true npm start' http://localhost:3000 'npx playwright test --project=firefox --trace on'